{% extends 'base.html.twig' %}

{% block title %}Annonce{% endblock %}

{% block body %}
    <h1>Annonce</h1>
<div class="container">
<div class="row">
<div class="col-md-6">
<div class="row">

{% set count = 0 %}
    {% for imag in img %}                
        {% set id_annn = imag.idAnnonce|replace({'   ': ""}) %}
        {% set annoce_id = annonce.id %}
        {# {% if count == 0 %} #}
            {% if id_annn == annoce_id %}
            <div class="col{% if count == 0 %}-12{% endif %} ">
                <img src="{{  imag.lien }}" class="card-img-top"  alt="..." onclick="window.open(this.src)">
            </div>
                {% set count = 1 %}
            {% endif %} 
        {# {% endif %}  #}
    {% endfor %}
        {% if count == 0%}
                <img src="\img_website\home-outline.svg" class="card-img-top" height="114" alt="...">
        {% endif %} 
</div>
</div>
{# </div> #}
<div class="col-md-6">
    <table class="table">
        <tbody>
            <tr>
                <td>{{ annonce.titre }}</td>
            </tr>
            <tr>
                <td>{{ annonce.description }}</td>
            </tr>
            <tr>
                <td>{{ annonce.adresse }}</td>
            </tr>
            <tr>
                <td>{{ annonce.Ville }}</td>
            </tr>
            <tr>
                <td>{{ annonce.CodePostal }}</td>
            </tr>
            <tr>
                <td>{{ annonce.prix }} â‚¬ / par nuit</td>
            </tr>
            <tr>
                <td>Date de fin de disponibiliter {{ annonce.datecreation ? annonce.datecreation|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
        </tbody>
    </table>
    <table class="table">
    {% set count_for_cat = 0 %}

    {% for opts in opt %}
        {% if opts.idAnnonce == annonce %}
    {% for loannonces in loannonce %}
  
    
    {% if loannonces == opts.idLibelle %}
    {% for CategoryRepositorys in CategoryRepository %}
                {% if CategoryRepositorys == loannonces.idCategory %}
                    {# {{ count_for_cat }} #}
                    {% if count_for_cat == 0 %}
                    <tr>
                        <td>Category</td>
                        <td>{{ CategoryRepositorys.libelle }}</td>
                    </tr>
                    {% else %}
                    {% endif %}
                    {% set count_for_cat = 1 %}
                {% endif %}
            {% endfor %}

    <tr>

            <td>{{ loannonces.value }}</td>
            <td>{{ opts.valeur }}</td>
    </tr>
    {% endif %}
    {% endfor %}
            {# {{ opts.idLibelle }} #}
        {% else %}
        {% endif %}
    {% endfor %}
    {# 'opt'=>$opt->findAll(),
    'loannonce'=>$loannonce->findAll(),
    'CategoryRepository'=>$CategoryRepository->findAll(), #}
    </table>


    
{% if app.user %}
<a href="{{ path('app_annonce_index') }}" class="btn btn-outline-secondary"> < back to list</a>
<div class="p-2"></div>
<a href="/reservation/new?idannonce={{ annonce.id }}" class="btn btn-outline-success">Reserver maintenant</a>
<div class="p-3"></div>

{# {{ app.user }}
{{ annonce.idUser }} #}
{% if app.user == annonce.idUser %}
<div class="btn-group" role="group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
      Modifier
    </button>
    <ul class="dropdown-menu">
      <li>
        <a class="btn" href="{{ path('app_annonce_edit', {'id': annonce.id}) }}">Modifier</a>
    </li>
      <li>{{ include('annonce/_delete_form.html.twig') }}</li>
    </ul>
  </div>
    
{% endif %}
{{ render(controller(
        'App\\Controller\\AvisAnnonceController::avisannonce', {id: annonce.id }
    )) }}

    <a href="{{ path('app_avis_annonce_new')}}?idannonce={{ annonce.id }}">ajouter avis</a>

{% else %}
<a href="{{ path('app_annonce_index') }}" class="btn btn-outline-secondary"> < back to list</a>
<a href="/login" class="btn btn-outline-success">Reserver maintenant</a>

{% endif %}

</div>

</div>
</div>

{% endblock %}
